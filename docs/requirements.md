# 要件定義

Claude Code Mobile Client の機能要件・非機能要件をまとめたドキュメント。

## 概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Claude Code Mobile Client |
| 目的 | Mac の Claude Code CLI にモバイルからアクセスする |
| 対象ユーザー | 開発者（個人利用） |
| 前提 | Tailscale VPN 経由でのアクセス |

---

## 機能要件

### FR-1: セッション管理

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| FR-1.1 | セッション作成 | 作業ディレクトリを指定して Claude CLI セッションを開始できる | ✅ 実装済 |
| FR-1.2 | セッション終了 | アクティブなセッションを終了できる | ✅ 実装済 |
| FR-1.3 | セッション一覧 | アクティブなセッションの一覧を取得できる | ✅ 実装済 |
| FR-1.4 | セッション永続化 | セッション情報とメッセージ履歴を SQLite に保存する | ❌ 未実装 |
| FR-1.5 | セッション復元 | 過去のセッション履歴を閲覧できる | ❌ 未実装 |
| FR-1.6 | セッション再接続 | プロセスが生きている場合、既存セッションに再接続できる | ❌ 未実装 |

### FR-2: メッセージング

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| FR-2.1 | メッセージ送信 | テキストメッセージを Claude に送信できる | ✅ 実装済 |
| FR-2.2 | 応答表示 | Claude の応答を Markdown でレンダリングして表示する | ✅ 実装済 |
| FR-2.3 | ツール使用表示 | ツール使用の詳細（名前、入力、結果）を表示する | ⚠️ 部分的 |
| FR-2.4 | 権限リクエスト UI | ツール実行の承認/拒否ボタンを表示する | ❌ 未実装 |
| FR-2.5 | 応答待ち表示 | スピナー + 「考え中...」テキストで応答待ちを表示する | ❌ 未実装 |
| FR-2.6 | 応答中断 | 停止ボタンまたは Esc キーで応答を中断できる | ✅ 実装済 |
| FR-2.7 | 日本語入力対応 | IME 変換確定時に送信されない（Enter で送信は変換完了後のみ） | ✅ 実装済 |

### FR-3: 接続管理

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| FR-3.1 | サーバー接続 | Bridge Server への WebSocket 接続を確立できる | ✅ 実装済 |
| FR-3.2 | 接続状態表示 | 接続/切断状態を UI に表示する | ✅ 実装済 |
| FR-3.3 | 自動再接続 | 接続が切れた場合に自動で再接続を試みる | ❌ 未実装 |

### FR-4: プロジェクト管理

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| FR-4.1 | プロジェクト一覧 | 利用可能なプロジェクトディレクトリの一覧を取得できる | ✅ 実装済 |
| FR-4.2 | ディレクトリ切替 | 作業ディレクトリを変更してセッションを開始できる | ⚠️ 部分的 |

---

## 非機能要件

### NFR-1: パフォーマンス

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| NFR-1.1 | メッセージ遅延 | WebSocket 経由のメッセージ遅延が 100ms 未満 | ✅ 達成 |
| NFR-1.2 | 同時セッション | 5 セッション以上を同時に管理できる | ✅ 達成 |

### NFR-2: セキュリティ

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| NFR-2.1 | パストラバーサル対策 | 許可されたディレクトリ外へのアクセスを防止する | ✅ 実装済 |
| NFR-2.2 | VPN 前提 | Tailscale VPN 経由のみでのアクセスを前提とする | ✅ 運用で対応 |
| NFR-2.3 | ディレクトリ制限 | ホームディレクトリと /tmp のみを許可する | ✅ 実装済 |

### NFR-3: 可用性

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| NFR-3.1 | 自動再接続 | Exponential backoff で自動再接続を試みる | ❌ 未実装 |
| NFR-3.2 | エラーリカバリー | エラー発生時に適切なメッセージを表示し、復旧を促す | ⚠️ 部分的 |

### NFR-4: ユーザビリティ

| ID | 要件 | 詳細 | 状態 |
|----|------|------|------|
| NFR-4.1 | モバイルファースト | スマートフォンでの操作に最適化された UI | ✅ 実装済 |
| NFR-4.2 | オフラインモード | Service Worker によるオフライン対応 | ❌ 未実装 |
| NFR-4.3 | ホーム画面追加 | PWA としてホーム画面に追加できる | ✅ マニフェスト済 |

---

## 凡例

| 状態 | 意味 |
|------|------|
| ✅ 実装済 | 完全に実装されている |
| ⚠️ 部分的 | 一部機能のみ実装されている |
| ❌ 未実装 | まだ実装されていない |
